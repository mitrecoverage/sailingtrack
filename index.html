<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Local Files Metadata List</title>
  <style>
    :root { color-scheme: light dark; }
    body { font-family: -apple-system, system-ui, sans-serif; margin: 16px; }
    h1 { font-size: 18px; margin: 0 0 10px; }
    .row { display: flex; gap: 10px; align-items: center; flex-wrap: wrap; }
    input[type="file"], button { font-size: 16px; }
    .meta { font-size: 13px; opacity: 0.85; }
    ul { padding-left: 18px; margin-top: 12px; }
    li { margin: 10px 0; }
    .name { font-weight: 600; word-break: break-word; }
    .actions { margin-top: 6px; display: flex; gap: 10px; align-items: center; flex-wrap: wrap; }
    .pill { display: inline-block; padding: 2px 8px; border: 1px solid #999; border-radius: 999px; font-size: 12px; }
    .danger { color: #b00020; }
    .hint { margin-top: 10px; }
  </style>
</head>
<body>
  <h1>Pick local files → list metadata (iOS Chrome compatible)</h1>

  <div class="row">
    <input id="picker" type="file" multiple />
    <button id="clearBtn" type="button">Clear list</button>
    <span class="pill" id="countPill">0 files</span>
  </div>

  <p class="meta hint">
    Notes (iOS): A web page can only access files you pick via the system file picker.
    External drives/microSD typically appear under the Files app if connected.
    Paths/folder names are not exposed to websites for privacy.
  </p>

  <ul id="list"></ul>

  <script>
    const fileMap = new Map(); // key -> File
    const picker = document.getElementById('picker');
    const list = document.getElementById('list');
    const clearBtn = document.getElementById('clearBtn');
    const countPill = document.getElementById('countPill');

    function formatBytes(bytes) {
      if (!Number.isFinite(bytes)) return '';
      const units = ['B', 'KB', 'MB', 'GB', 'TB'];
      let i = 0;
      let v = bytes;
      while (v >= 1024 && i < units.length - 1) { v /= 1024; i++; }
      return `${v.toFixed(i === 0 ? 0 : 2)} ${units[i]}`;
    }

    function updateCount() {
      countPill.textContent = `${fileMap.size} file${fileMap.size === 1 ? '' : 's'}`;
    }

    function render() {
      list.innerHTML = '';
      const entries = Array.from(fileMap.entries());

      if (entries.length === 0) {
        const li = document.createElement('li');
        li.className = 'meta';
        li.textContent = 'No files selected yet.';
        list.appendChild(li);
        updateCount();
        return;
      }

      for (const [key, file] of entries) {
        const li = document.createElement('li');

        const name = document.createElement('div');
        name.className = 'name';
        name.textContent = file.name || '(unnamed file)';
        li.appendChild(name);

        const type = file.type || 'unknown';
        const size = formatBytes(file.size);
        const modified = file.lastModified ? new Date(file.lastModified).toLocaleString() : 'unknown';

        const meta = document.createElement('div');
        meta.className = 'meta';
        meta.textContent = `Type: ${type} • Size: ${size} • Modified: ${modified}`;
        li.appendChild(meta);

        const actions = document.createElement('div');
        actions.className = 'actions';

        const removeBtn = document.createElement('button');
        removeBtn.type = 'button';
        removeBtn.className = 'danger';
        removeBtn.textContent = 'Remove';
        removeBtn.addEventListener('click', () => {
          fileMap.delete(key);
          render();
        });
        actions.appendChild(removeBtn);

        li.appendChild(actions);
        list.appendChild(li);
      }

      updateCount();
    }

    picker.addEventListener('change', () => {
      const files = Array.from(picker.files || []);
      for (const f of files) {
        // De-dup across multiple picks
        const key = `${f.name}__${f.size}__${f.lastModified}__${f.type}`;
        if (!fileMap.has(key)) fileMap.set(key, f);
      }
      // Reset the input so picking the same files again triggers change on iOS
      picker.value = '';
      render();
    });

    clearBtn.addEventListener('click', () => {
      fileMap.clear();
      render();
    });

    render();
  </script>
</body>
</html>
